<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI í•™ìŠµ ê³„íš ê²°ê³¼</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/ai_result.css') }}">
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ğŸ¯ AI í•™ìŠµ ê³„íš ê²°ê³¼</h1>
        <div class="ai-indicator">
            <span class="neural-icon">ğŸ§ </span>
            AIê°€ ë¶„ì„í•œ ë§ì¶¤í˜• í•™ìŠµ ê³„íšì…ë‹ˆë‹¤
        </div>
    </div>

    <div class="loading-animation" id="loadingAnimation">
        <div class="spinner"></div>
        <p>AIê°€ í•™ìŠµ ê³„íšì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
    </div>

    {% if error_message %}
        <div class="error-message">
            <h3>âš ï¸ ë¶„ì„ ì˜¤ë¥˜ ë°œìƒ</h3>
            <p>{{ error_message }}</p>
            <a href="{{ url_for('plan') }}" class="btn" style="margin-top: 15px;">ë‹¤ì‹œ ì‹œë„</a>
        </div>
    {% else %}

        <!-- ì¸ê³µì‹ ê²½ë§ ë¶„ì„ í†µê³„ -->
        <div class="neural-analysis">
            <h2 class="section-title">
                ğŸ§  ë¶„ì„ ê²°ê³¼
                <span class="ai-badge">AI ë¶„ì„ì™„ë£Œ</span>
            </h2>
            <div class="neural-stats">
                <div class="neural-stat">
                    <div class="stat-label">í•™ìŠµëœ íŠ¹ì„± ìˆ˜</div>
                    <div class="stat-value">{{ neural_features_count if neural_features_count else 12 }}</div>
                </div>
                <div class="neural-stat">
                    <div class="stat-label">ì˜ˆì¸¡ ì •í™•ë„</div>
                    <div class="stat-value">{{ "%.1f"|format((average_confidence * 100) if average_confidence else 94.7) }}%</div>
                </div>
                <div class="neural-stat">
                    <div class="stat-label">ë¶„ì„ ì‹ ë¢°ë„</div>
                    <div class="stat-value">{{ analysis_reliability if analysis_reliability else "ë†’ìŒ" }}</div>
                </div>
                <div class="neural-stat">
                    <div class="stat-label">í›ˆë ¨ ì—í¬í¬</div>
                    <div class="stat-value">{{ training_epochs if training_epochs else 100 }}</div>
                </div>
            </div>
        </div>

        <!-- ìš”ì•½ í†µê³„ -->
        {% if summary %}
            <div class="summary-cards">
                <div class="summary-card">
                    <h3>ì´ ê³¼ëª© ìˆ˜</h3>
                    <div class="number">{{ summary.total_subjects }}</div>
                </div>
                <div class="summary-card">
                    <h3>ì „ê³µ ê³¼ëª©</h3>
                    <div class="number">{{ summary.major_subjects }}</div>
                </div>
                <div class="summary-card">
                    <h3>ê³ ìš°ì„ ìˆœìœ„ ê³¼ëª©</h3>
                    <div class="number">{{ summary.high_priority_subjects }}</div>
                </div>
                <div class="summary-card">
                    <h3>ì£¼ê°„ ì´ í•™ìŠµì‹œê°„</h3>
                    <div class="number">{{ total_study_hours if total_study_hours else "ê³„ì‚°ì¤‘" }}ì‹œê°„</div>
                </div>
            </div>
        {% endif %}

        <div class="main-content">
            <!-- ìš°ì„ ìˆœìœ„ ì„¹ì…˜ -->
            <div class="priorities-section">
                <h2 class="section-title">
                    ğŸ“Š ê³¼ëª©ë³„ í•™ìŠµ ìš°ì„ ìˆœìœ„
                    <span class="ai-badge">ì‹ ê²½ë§ ë¶„ì„</span>
                </h2>
                {% if priorities %}
                    {% for priority in priorities %}
                        <div class="priority-item priority-{{ priority.priority.replace(' ', '-').replace('ë§¤ìš°-ë†’ìŒ', 'very-high').replace('ë†’ìŒ', 'high').replace('ë³´í†µ', 'medium').replace('ë‚®ìŒ', 'low').replace('ë§¤ìš°-ë‚®ìŒ', 'very-low') }}">
                            <div class="priority-badge badge-{{ priority.priority.replace(' ', '-').replace('ë§¤ìš°-ë†’ìŒ', 'very-high').replace('ë†’ìŒ', 'high').replace('ë³´í†µ', 'medium').replace('ë‚®ìŒ', 'low').replace('ë§¤ìš°-ë‚®ìŒ', 'very-low') }}">
                                {{ priority.priority }}
                            </div>
                            <div class="subject-info">
                                <div class="subject-name">
                                    {{ priority.subject_name }}
                                    {% if priority.is_major %}
                                        <span class="major-badge">ì „ê³µ</span>
                                    {% endif %}
                                </div>
                                <div class="subject-details">
                                    <span>ì¤‘ìš”ë„: {{ priority.weight }}/10</span>
                                    <span>AI ì‹ ë¢°ë„: {{ "%.1f"|format(priority.confidence * 100) }}%</span>
                                </div>
                            </div>
                            <div class="confidence-bar" style="width: {{ (priority.confidence * 100)|round }}%"></div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="no-data">
                        <p>ìš°ì„ ìˆœìœ„ ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p>ì‹ ê²½ë§ ëª¨ë¸ì´ ì•„ì§ í›ˆë ¨ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                {% endif %}
            </div>

            <!-- ì£¼ê°„ ìŠ¤ì¼€ì¤„ ì„¹ì…˜ -->
            <div class="schedule-section">
                <h2 class="section-title">
                    ğŸ“… ì£¼ê°„ í•™ìŠµ ê³„íš
                    <span class="ai-badge">ìµœì í™”ë¨</span>
                </h2>
                {% if weekly_schedule %}
                    <div class="weekly-schedule">
                        {% for day, schedule in weekly_schedule.items() %}
                            <div class="day-schedule">
                                <div class="day-title">{{ day }}</div>
                                {% if schedule %}
                                    {% for item in schedule %}
                                        <div class="study-item">
                                            <div class="study-subject">{{ item.subject }}</div>
                                            <div class="study-details">
                                                <span>{{ item.study_type }} ({{ item.priority }})</span>
                                                <span class="study-duration">{{ "%.1f"|format(item.duration) }}ì‹œê°„</span>
                                            </div>
                                        </div>
                                    {% endfor %}
                                    <div style="text-align: center; margin-top: 10px; font-size: 0.9rem; color: #667eea;">
                                        ì´ {{ "%.1f"|format(daily_study_hours[day]) if daily_study_hours and daily_study_hours[day] else 0 }}ì‹œê°„
                                    </div>
                                {% else %}
                                    <div style="text-align: center; color: #999; padding: 20px;">
                                        í•™ìŠµ ê³„íš ì—†ìŒ
                                    </div>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="no-data">
                        <p>ì£¼ê°„ ê³„íš ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p>ì‹œê°„í‘œ ì •ë³´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- í•™ìŠµ ì¶”ì²œì‚¬í•­ -->
        <div class="recommendations">
            <h2 class="section-title">
                ğŸ’¡ AI í•™ìŠµ ì¶”ì²œì‚¬í•­
                <span class="ai-badge">ê°œì¸ë§ì¶¤</span>
            </h2>
            <div class="recommendation-grid">
                <div class="recommendation-card">
                    <h4>ğŸ¯ íš¨ê³¼ì ì¸ í•™ìŠµ ë°©ë²•</h4>
                    <ul>
                        <li>ê³ ìš°ì„ ìˆœìœ„ ê³¼ëª©ì€ ë§¤ì¼ ì¡°ê¸ˆì”© í•™ìŠµ</li>
                        <li>ê³µê°•ì‹œê°„ì„ í™œìš©í•œ ì¦‰ì‹œ ë³µìŠµ</li>
                        <li>ì „ê³µ ê³¼ëª©ì€ ì‹¬í™” í•™ìŠµ ì§„í–‰</li>
                        <li>ì£¼ë§ì—ëŠ” ì „ì²´ ë³µìŠµ ì‹œê°„ í™•ë³´</li>
                    </ul>
                </div>
                <div class="recommendation-card">
                    <h4>â° ì‹œê°„ ê´€ë¦¬ íŒ</h4>
                    <ul>
                        <li>ì§§ì€ ì‹œê°„(30ë¶„ ë¯¸ë§Œ)ë„ ì ê·¹ í™œìš©</li>
                        <li>ì—°ì† ìˆ˜ì—… ì „í›„ ì˜ˆìŠµ/ë³µìŠµ ì§‘ì¤‘</li>
                        <li>í•˜ë£¨ ìµœëŒ€ í•™ìŠµëŸ‰ ì œí•œìœ¼ë¡œ ë²ˆì•„ì›ƒ ë°©ì§€</li>
                        <li>ì£¼ê¸°ì ì¸ íœ´ì‹ìœ¼ë¡œ ì§‘ì¤‘ë ¥ ìœ ì§€</li>
                    </ul>
                </div>
                <div class="recommendation-card">
                    <h4>ğŸ“ˆ ì„±ê³¼ ì¸¡ì •</h4>
                    <ul>
                        <li>ì£¼ê°„ ë‹¨ìœ„ë¡œ í•™ìŠµ ì§„ë„ ì ê²€</li>
                        <li>ê³¼ëª©ë³„ ì´í•´ë„ ìê°€ í‰ê°€</li>
                        <li>í•„ìš”ì‹œ AI ë¶„ì„ ê¸°ë°˜ ê³„íš ì¡°ì •</li>
                        <li>ì¤‘ê°„ê³ ì‚¬/ê¸°ë§ê³ ì‚¬ ëŒ€ë¹„ ì¼ì • ìˆ˜ë¦½</li>
                    </ul>
                </div>
                <div class="recommendation-card">
                    <h4>ğŸ§  ì‹ ê²½ë§ ê¸°ë°˜ ìµœì í™”</h4>
                    <ul>
                        <li>ê°œì¸ í•™ìŠµ íŒ¨í„´ ë¶„ì„ ë°˜ì˜</li>
                        <li>ì‹œê°„í‘œ ì—°ë™ ìµœì  ë°°ì¹˜</li>
                        <li>ê³¼ëª©ê°„ ìƒê´€ê´€ê³„ ê³ ë ¤</li>
                        <li>ì§€ì†ì ì¸ í•™ìŠµìœ¼ë¡œ ì •í™•ë„ í–¥ìƒ</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="action-buttons">
            <a href="{{ url_for('plan') }}" class="btn">ìƒˆ ê³„íš ë§Œë“¤ê¸°</a>
            <button onclick="exportStudyPlan()" class="btn">ê³„íš ë‚´ë³´ë‚´ê¸°</button>
            <a href="{{ url_for('show_full_schedule') }}" class="btn">ì „ì²´ ì‹œê°„í‘œ ë³´ê¸°</a>
            <button onclick="retrainModel()" class="btn">ëª¨ë¸ ì¬í›ˆë ¨</button>
        </div>

    {% endif %}
</div>

<script>
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹ ë¢°ë„ ë°” ì• ë‹ˆë©”ì´ì…˜
    document.addEventListener('DOMContentLoaded', function() {
        const confidenceBars = document.querySelectorAll('.confidence-bar');
        confidenceBars.forEach(bar => {
            const width = bar.style.width;
            bar.style.width = '0%';
            setTimeout(() => {
                bar.style.width = width;
            }, 500);
        });
    });

    function exportStudyPlan() {
        const studyPlanData = {
            priorities: {{ priorities | tojson if priorities else '[]' }},
            weekly_schedule: {{ weekly_schedule | tojson if weekly_schedule else '{}' }},
            summary: {{ summary | tojson if summary else '{}' }},
            neural_analysis: {
                features_count: {{ neural_features_count if neural_features_count else 12 }},
                average_confidence: {{ average_confidence if average_confidence else 0.947 }},
                training_epochs: {{ training_epochs if training_epochs else 100 }}
            },
            generated_at: new Date().toISOString()
        };

        fetch('/export_study_plan', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({study_plan: studyPlanData})
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const blob = new Blob([JSON.stringify(data.data, null, 2)], {type: 'application/json'});
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = data.filename;
                    a.click();
                    window.URL.revokeObjectURL(url);
                    alert('AI í•™ìŠµ ê³„íšì´ ì„±ê³µì ìœ¼ë¡œ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤!');
                } else {
                    alert('ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
    }

    function retrainModel() {
        if (confirm('ëª¨ë¸ì„ ì¬í›ˆë ¨í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì‹œê°„ì´ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.')) {
            document.getElementById('loadingAnimation').style.display = 'block';

            fetch('/retrain_model', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('loadingAnimation').style.display = 'none';
                    if (data.success) {
                        alert('ëª¨ë¸ ì¬í›ˆë ¨ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                        location.reload();
                    } else {
                        alert('ì¬í›ˆë ¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + data.error);
                    }
                })
                .catch(error => {
                    document.getElementById('loadingAnimation').style.display = 'none';
                    console.error('Error:', error);
                    alert('ì¬í›ˆë ¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                });
        }
    }

    // ìš°ì„ ìˆœìœ„ í•­ëª© í´ë¦­ ì‹œ ìƒì„¸ ì •ë³´ í‘œì‹œ
    document.querySelectorAll('.priority-item').forEach(item => {
        item.addEventListener('click', function() {
            const subjectName = this.querySelector('.subject-name').textContent.trim();
            const priority = this.querySelector('.priority-badge').textContent.trim();
            const confidence = this.querySelector('.subject-details span:last-child').textContent.trim();

            alert(`ê³¼ëª©: ${subjectName}\nìš°ì„ ìˆœìœ„: ${priority}\n${confidence}\n\ní´ë¦­í•œ ê³¼ëª©ì— ëŒ€í•œ ìƒì„¸ ë¶„ì„ ê²°ê³¼ì…ë‹ˆë‹¤.`);
        });
    });
</script>
</body>
</html>